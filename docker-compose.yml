version: "3.9"
services:
  localstack:   # AWS
    image: localstack/localstack:latest
    ports: ["4566:4566"]
    environment:
      - SERVICES=s3,dynamodb,lambda,apigateway,logs,cloudwatch,iam,sts,ecr,events,stepfunctions
      - AWS_DEFAULT_REGION=us-east-1
    volumes:
      - ./.localstack:/var/lib/localstack
      - /var/run/docker.sock:/var/run/docker.sock

  azurite:      # Azure Storage (Blob/Queue/Table)
    image: mcr.microsoft.com/azure-storage/azurite
    command: azurite -l /data --blobHost 0.0.0.0 --queueHost 0.0.0.0 --tableHost 0.0.0.0
    ports: ["10000:10000","10001:10001","10002:10002"]
    volumes: ["./.azurite:/data"]

  gcp-pubsub:   # GCP Pub/Sub emulator
    image: gcr.io/google.com/cloudsdktool/cloud-sdk:emulators
    command: gcloud beta emulators pubsub start --host-port=0.0.0.0:8085
    ports: ["8085:8085"]
